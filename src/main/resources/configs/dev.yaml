# ============================================================================
# CONFIGURATION FINALE MULESOFT - URLS CORRIGÉES
# Fichier: src/main/resources/configs/dev.yaml
# ============================================================================

# Configuration HTTP
http:
  port: "8080"
  host: "0.0.0.0"
  
# Configuration Sécurité  
api:
  id: "20414799"
  main: "kitinterconnexionuemoa-main"
  key:
    commission: "COMMISSION_SECRET_KEY"

# ✅ CORRECTION MAJEURE: URLs des Systèmes Externes - URLs RÉELLES des simulateurs Vercel
systeme:
  paysA:
    # ⚠️ REMPLACER par l'URL Vercel réelle de Pays A
    host: "simulateur-pays-a-cotier.vercel.app"  # ← URL à adapter selon votre déploiement
    port: "443"
    url: "https://simulateur-pays-a-cotier.vercel.app"
    endpoints:
      health: "/api/health"
      mainlevee: "/api/mainlevee/autorisation"
      
  paysB:
    # ⚠️ REMPLACER par l'URL Vercel réelle de Pays B
    host: "simulateur-pays-b-hinterland.vercel.app"  # ← URL à adapter selon votre déploiement
    port: "443"
    url: "https://simulateur-pays-b-hinterland.vercel.app"
    endpoints:
      health: "/api/health"
      manifeste: "/api/manifeste/reception"

# ✅ CORRECTION MAJEURE: URL Commission UEMOA - URL RÉELLE du simulateur
commission:
  uemoa:
    # ⚠️ REMPLACER par l'URL Vercel réelle de Commission UEMOA
    host: "simulateur-commission-uemoa.vercel.app"  # ← URL à adapter selon votre déploiement
    port: "443"
    url: "https://simulateur-commission-uemoa.vercel.app"
    endpoints:
      health: "/api/health"
      tracabilite: "/api/tracabilite/enregistrer"  # ✅ Path correct SANS /v1
    auth:
      token: "COMMISSION_TOKEN"

### Database config (inchangé) ####
db:
  driver: "org.h2.Driver"
  url_interco: "jdbc:h2:mem:interconnexion;DB_CLOSE_DELAY=-1"
  user: "sa"
  password: ""
  
oauth:
  client:
    id: "interconnexion_client"
    secret: "interconnexion_secret"

# Configuration Monitoring
monitoring:
  enabled: "true"
  
# Configuration Logging
logging:
  level: "INFO"
  
# ✅ AMÉLIORATION: Configuration CORS étendue pour les tests depuis les dashboards
cors:
  enabled: "true"
  origins: 
    - "*.vercel.app"  # Accepter toutes les URLs Vercel pour les tests
    - "localhost"     # Pour les tests locaux
    - "127.0.0.1"     # Pour les tests locaux
  headers:
    - "Content-Type"
    - "Authorization"
    - "X-Source-Country"
    - "X-Source-System"
    - "X-Correlation-ID"
    - "X-Test-Type"
    - "X-Authorization-Source"
    - "User-Agent"

# ✅ AMÉLIORATION: Configuration timeout pour la robustesse
external:
  timeout:
    connection: "15000"  # 15 secondes (augmenté pour Vercel)
    read: "20000"        # 20 secondes (augmenté pour Vercel)
    
# ✅ AMÉLIORATION: Configuration retry pour la robustesse Vercel
retry:
  attempts: "3"
  delay: "3000"  # 3 secondes entre tentatives (augmenté pour Vercel)